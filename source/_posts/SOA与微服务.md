title: SOA与微服务
date: 2018-01-16 17:35:18
tags: SOA

---

### 微服务架构重点

**业务系统需要彻底的组件化和服务化**

原有的单个业务系统会拆分为多个可以独立开发，设计，运行和运维的小应用
这些小应用通过服务完成交互和集成，每个小应用从前端web UI，控制层，逻辑层，数据库访问，数据库都完全是独立的一套
每个小应用除了完成自身本身的业务功能外，重点就是还需要消费外部其他应用暴露的服务，同时也将自身的能力朝外部发布为服务

### 一句话区别SOA和微服务

**即微服务不再强调传统SOA架构里面比较重的ESB企业服务总线，同时SOA的思想进入到耽搁业务系统内部实现真正的组件化**

### 对微服务架构的一些定义和阐述


> 微服务可以在自己的程序中运行，并通过轻量级设备与HTTP型API进行沟通
> 在服务公开中，许多服务都可以被内部独立进程所限制，如果其中任何一个服务需要增加某个功能，那么必须缩小进程范围
> 在微服务架构中，只需要在特定的某种服务中增加所需功能，而不影响整体进程

> 微服务不需要像普通服务那样成为一种独立的功能或者独立的资源，定义中称，微服务是需要与有业务能力相匹配，是完全正确的，不幸的是，仍然意味着，如果能力模型粒度的设计师错误的，那么，必须付出很多代价
> 在决定将所有组件组合到一起时，开发人员需要非常确信这些组件都会有所改变，并且大规模变化。服务粒度越粗，久越难以符合规定原则。服务粒度越细，就越能灵活的降低变化和负载所带来的的影响。然而，利弊之间的权衡过程是非常复杂的，我们要在配置和资金模型的基础上考虑到基础设施的成本问题

### 强调以下几点

**首先，对于应用本省暴露出来的服务**，是和应用一起部署的，即服务本身并不单独部署，服务本身就是业务组件已有的接口能力发布和暴露出来的。这些接口我们可以根据和外部其他组件协同的需要将其发布为微服务，而如果不需要对外协同我们完全可以走内部api接口访问模式提高效率

**其次，微服务架构本身来源于互联网的思路**，因此组件对外发布的服务器强调了采用HTTP rest API的方式来进行
组件朝外部暴露的能力需要发布为微服务，其本身也是一种封装后的粗粒度服务，而不是将组件内部的业务规则和逻辑，组件本身的底层数据库CURD操作全部朝外部发布

**再次，微服务的基本思想在于考虑围绕着业务领域组件来创建应用**，这些就应用可独立的进行开发，管理和加速，在分散的组件中使用微服务云架构和平台式部署，管理和服务功能交付变的更加简单

前面这些问题思考清楚后就是考虑所有暴露的微服务是否需要一个统一的服务管控和治理平台，按这个架构思路，虽然单个服务的实现和发布仍然是在组件内部完成，但是这些组件暴露的服务本身的调用情况，**服务本身的安全，日志，流量控制等仍是需要一个统一的SOA服务管理平台来完成**

由于微服务尽量都是HTTP API的方式暴露出去的，因此这种服务管理不需要像传统企业内部的ESB服务总线那么重，但是**最基本的服务注册，服务代理，服务发布，服务简单的路由，安全访问和授权，服务调用消息和日志记录**这些功能还是需要具备

对于这种服务管控平台，核心需要讨论的就是服务每次调用本身的消息传递，输入和输出日志是否需要记录，当前有两种做法
一种是不记录，管理平台只负责服务注册和目录发布，安全授权，实际的服务访问仍然是两个组件之间的点对点对接完成，这种方式下的架构下获取更高的性能，同时服务管理平台也不容易成为大并发服务访问下的单点瓶颈；
另外一种就是完全记录，在这种方式下就需要考虑服务管理平台本身是否集群化不是，高并发下及性能问题；
而个人建议最好的方式还是**SOA服务管理平台应该提供两种管理能力，同时仅仅对核心需要log日志的服务日志记录，而其他服务只提供服务目录和访问控制即可**
